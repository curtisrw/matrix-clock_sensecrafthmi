<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Matrix Time</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000000;
      color: #00ff00;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
                   "Segoe UI", sans-serif;
      overflow: hidden;
    }

    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="matrix"></canvas>

  <script>
    // ------- TIME (12-HOUR FORMAT WITH AM/PM, ROUNDED TO 5 MINUTES) -------
    function pad(n) {
      return n < 10 ? "0" + n : "" + n;
    }

    function getRoundedTimeString() {
      const now = new Date();

      // Round DOWN to nearest 5 minutes
      const rounded = new Date(now);
      const flooredMinutes = Math.floor(rounded.getMinutes() / 5) * 5;
      rounded.setMinutes(flooredMinutes, 0, 0);

      // Convert to 12-hour time
      let hours = rounded.getHours();
      const minutes = pad(rounded.getMinutes());
      const ampm = hours >= 12 ? "PM" : "AM";

      hours = hours % 12;
      if (hours === 0) hours = 12; // midnight/noon edge case
      const hoursStr = pad(hours);

      // Example output: "10:15 AM"
      return `${hoursStr}:${minutes} ${ampm}`;
    }

    const timeString = getRoundedTimeString();


    // ------------------------ MATRIX BACKGROUND ------------------------
    const canvas = document.getElementById("matrix");
    const ctx = canvas.getContext("2d");

    const letters = "01ABCDEFGHIJKLMNOPQRSTUVWXYZ#$%&*+-";
    let drops = [];
    let fontSize = 16;
    let columns = 0;

    // Time embedding coordinates
    let timeCols = [];
    let timeRow = 0;

    function initCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      fontSize = 16;
      columns = Math.floor(canvas.width / fontSize);

      drops = [];
      for (let i = 0; i < columns; i++) {
        drops[i] = Math.floor(Math.random() * -20);
      }

      // Place the time centered horizontally inside the rain
      const len = timeString.length; 
      const baseCol = Math.floor(columns / 2) - Math.floor(len / 2);

      timeCols = [];
      for (let i = 0; i < len; i++) {
        timeCols.push(baseCol + i);
      }

      // Vertically center the time
      timeRow = Math.floor(canvas.height / (2 * fontSize));
    }

    function drawMatrixFrame() {
      // trail effect
      ctx.fillStyle = "rgba(0,0,0,0.22)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.font = fontSize + "px monospace";

      // Background rain
      ctx.fillStyle = "#00aa00"; // slightly dimmer green for background rain
      for (let i = 0; i < drops.length; i++) {
        const text = letters.charAt(Math.floor(Math.random() * letters.length));
        const x = i * fontSize;
        const y = drops[i] * fontSize;

        ctx.fillText(text, x, y);

        if (y > canvas.height && Math.random() > 0.95) {
          drops[i] = Math.floor(Math.random() * -10);
        } else {
          drops[i]++;
        }
      }

      // TIME CHARACTERS â€” brighter and bolder ðŸ’¡
      ctx.fillStyle = "#00ff55"; // stronger green (more visible on e-ink)
      ctx.font = "bold " + fontSize + "px monospace";

      for (let i = 0; i < timeString.length; i++) {
        const col = timeCols[i];
        const ch = timeString.charAt(i);

        const x = col * fontSize;
        const y = timeRow * fontSize;

        ctx.fillText(ch, x, y);
      }
    }

    // Initialize and animate (panel will only show snapshots)
    initCanvas();
    window.addEventListener("resize", initCanvas);

    // Continuous animation (e-ink will capture only periodic snapshots)
    setInterval(drawMatrixFrame, 200);
  </script>
</body>
</html>
